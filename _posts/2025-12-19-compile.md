---
title: "컴파일"
excerpt: "전체 과정"

categories:
  - Compile
tags:
  - [Complie]

permalink: /Complie/

toc: true
toc_sticky: true

date: 2025-12-22
last_modified_at: 2025-12-24
---

# 컴파일에 관하여

#### 전체 과정
   
> 전처리(Preprocessing) - 컴파일(Compilation) - 어셈블(Assembly) - 링크(Linking)
   
### 전처리(Preprocessing)
   
\#include, #define, #if같은 전처리 지시문에 해당하는 것들을 변환합니다.
컴파일러의 개입 이전에 텍스트로 재구성하는 단계이고 의미 해석, 타입 검사, 링크는 없습니다.   
전처리 단계에서는 플랫폼, 빌드 옵션, 디버그/릴리즈, 에디터/런타임과 같은 차이를 소스 코드 수준에서
정리합니다. 이를 통해 다른 실행 환경에서 쉽게 변경하고 컴파일 할 수 있도록 합니다.   

###### #include
   
해당 파일의 내용을 현재 위치에 그대로 복사해서 붙여 넣는 것을 의미합니다.   

> \#include "NewHeader.h   
이는 다음과 같습니다.   
> NewHeader.h의 전체 내용 텍스트   

같은 헤더를 여러 번 include시 그 내용도 여러번 복사되며 
이를 막기 위해 incldue guard(매크로 기반, 표준C++)와 #pragma once(파일 단위 기반, 비표준이나 거의 지원)를 사용합니다.   

##### #define
   
선언이 아닌 치환규칙입니다.
> \#define SIZE 10
   
이의 전처리 결과는 다음과 같습니다.
      
> int arr[SIZE]; // int arr[10];
   
SIZE라는 토큰을 10이라는 문자열로 치환하라는 규칙입니다.   

##### \#if
   
전처리 시점에서 소스 코드의 일부를 존재하지 않게 만들거나 포함시키는 조건부 컴파일에 해당합니다.
   
	#if DEBUG
		Log();
	#endif
   
위와 같은 코드에서 DEBUG가 정의되어 있지 않은 경우 전처리 결과로 아무것도 없는 상태가 나옵니다.
   
	#if (debug)
	{	
		Log();
	}
   
위 코드에서 debug == false가 나오는 경우 실행만 불가능한 상태로 분기 명령, 명령 캐시 사용, 코드 크기 증가와도 같은
비용은 그대로 존재하게 됩니다.
   
### 컴파일(Compilation)
   
텍스트로 된 소스 코드를 링크 가능한 목적 파일(.o , .obj)로 변환합니다.
목적 파일에는 기계어와 후에 링크 단계에서 필요한 심볼(symbol)정보와 재배치(relocation)정보 또한 포함됩니다.
   
심볼은 이 함수/변수의 이름, 정의 위치, 외부 참조 여부를 확인하는데 사용되고 
재배치는 후에 실제 주소가 결정되었을 때 이 기계어의 이 위치를 수정해야한다라는 패치포인트를 아는데 사용됩니다.
   
이 단계에서는 주소가 확정되지 않습니다. 프로세스가 실제로 로드되는 때의 최종 주소는 아직 모르는 상태로 진행됩니다.
   
컴파일러가 소스 코드를 읽을 때의 과정은 다음과 같습니다.
   
##### 구문 분석(Syntax analysis)

- 가장 앞단에서 렉서(lexer)가 문자 흐름을 토큰(token)으로 쪼갭니다.
   
	int sum(int a, int b)
	{
	return a + b;
	}
   
\위와 같은 코드가 들어오는 경우
	int, sum, (, int, a, , , ... 와 같은 단위로 분해됩니다.
   
- 파서(parser)가 토큰열을 이용해 문법 규칙에 맞는 트리 구조를 생성합니다.
   보통 이 결과를 파스 트리(parse tree)라 합니다.
- 파스 트리에서 불필요한 문법 요소를 줄이고 의미 중심으로 만든 것을 AST(Abstract Syntax Tree)라 합니다.
   AST는 컴파일러가 이후 단계에서 이 코드가 무엇을 할 것인지 계산하기 좋은 형태로 만든 설계도에 해당합니다.
   
\
##### 의미 분석 (sementic analysis)
   
이 단계에서 수행하는 작업은 크게 두 가지로 나뉩니다.
   
- 코드가 문법적으로 맞는지 체크
   
\변수 사용 시 선언 유무, 변수 타입, 함수 호출 시의 인자 개수/타입, 접근 제어 가능 여부와 같은 것을 이 작업에서 확인합니다.
   
- 심볼 테이블(symbol table) 구축
   
심볼 테이블은 다음과 같은 정보를 포함합니다.
   
> 각 심볼이 무엇인지(함수/전역/지역/정적), 타입, 저장위치, 외부링크 가능여부(링키지), 섹션 배치 스타일과 같은 메타데이터
\
   
